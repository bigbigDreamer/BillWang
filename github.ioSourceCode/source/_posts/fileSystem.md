---
title: Linux文件系统
date: 2018-11-13 16:57:14
tags:
  - Linux
  - EXT
  - FAT
---

## EXT文件系统

### 原理阐述

> &emsp;&emsp;linux的Ext系列文件系统就是一种索引式文件系统。 当inode与block过多时，为便于管理，Ext文件系统在格式化时，划分了多个块组（block group）。每个块组都有独立的superblock、inode、block。
>
> &emsp;&emsp;Ext文件系统最前端，有一个启动扇区（boot sector），可安装引导程序（bootloader），从而制作出多重引导环境（安装不同操作系统），而不用覆盖整块磁盘唯一的MBR。
>
>EXT文件总体结构
<table style="margin-top:-125px">
<tr>
<td>
启动扇区
</td>
<td>
block Group1
</td>
<td>
block Group2
</td>
<td>
block Group n...
</td>
</tr>
</table>

> 每个块组结构如下：
<table style="margin-top:-125px" >
<tr>
<td>
superblock
</td>
<td>
文件系统描述
</td>
<td>
块对应表
</td>
<td>
inode对应表
</td>
<td>
inode table
</td>
<td>
data block
</td>
</tr>
</table>

>superblock
>>superblock记录的信息主要有：
>>
>>- inode与block的总量；
>>- 已使用和未使用的inode、block数量；
>>- block与inode的大小。block大小只能是1K、2K或4K，inode大小为128字节或256字节（ext4）；
>>- 最近一次挂载、写入、检验时间；
>>- 文件系统是否已被挂载等。
>>- 每个文件系统仅有一个superblock。结合上图，除了第一个块组有superblock，其他块组未必有。其他块组如果有，也是为了备份，内容和第一个块组中的superblock一样。因为superblock记录的信息很重要。

>文件系统描述（GDT）
>>记录每个块组开始与结束的block号码，及各块组中这6个区段的开始与结束的block。
>
>块对应表
>>记录哪些号码的block未使用，哪些已使用。
>
>inode对应表
>>记录哪些号码的inode未使用，哪些已使用。
>
>inode table
>>就是inode保存的信息，至少有：
>>- 访问权限（rwx），包括特殊权限（SUID等）；
>>- 属主、属组；
>>- 时间戳；
>>- 文件大小；
>>- 文件的实际内容指向，即实际内容在哪些block。
>>- 每个inode大小是固定的，Ext2、3是128字节，Ext4是256字节3。
>>- 每个文件对应一个inode，所以inode的个数决定了一个文件系统上能创建的文件个数。
>>- 用户在读取文件时，系统先找到inode，然后分析这个inode记录的权限是否与用户符合，若符合即读取该inode指向的block的内容。
>>- inode本身也是存储在磁盘block上的，比如Ext3的每个inode大小128字节，那么一个1K的block可存储8各inode。
>
>data block
>>存储文件内容，每个的大小只能是1K、2K或4K，具体使用的大小是多少会在superblock中记录；
>
>>每个block只能存一个文件的数据。若文件内容大于1个block，则使用多个block存储；若文件内容小于一个block，比如一个1K的文件，文件系统的block大小使用的是2K的话，那么这个block有1K则是浪费的4。

## FAT文件系统

### 原理阐述

>&emsp;&emsp;FAT文件起源于70年代末80年代初，用于微软的MS-DOS操作系统。它开始被设计成一个简单的文件系统用于小于500K的软件盘。后来被功能被大大增强用于支持越来越大的媒质。现在的文件系统有FAT12，FAT16和FAT32三种子类。
>
>&emsp;&emsp;FAT12是最早的一版，主要用于软盘，它对簇的编址采用12bit宽度的数，所以称为FAT12。12bit的地址可以寻址4096个簇，事实上在FAT12中只能寻址4078个簇（在Linux下可寻址4084个簇），有一些簇号是不能用的，在后面会给出具体的说明。磁盘的扇区是用16bit的数进行计算的，所以磁盘的容量就被局限在32M空间之内。
>
>&emsp;&emsp;在FAT16中，采用了16bit宽的簇地址，32bit宽扇区地址。虽然32bit的扇区地址可以寻址2^32*512，约2个TB的容量，但于由规定每簇最大的容量不超过1024*32，所以FAT16文件系统的容量也就限制到了2^16*1024*32，大约2.1GB的空量，并且实际还达不到这个值。
>
>&emsp;&emsp;FAT32文件系统使用了32bit宽的簇地址，所以称为FAT32。但在微软件的文件系统中只使用了低28位，最大容量为2^28*1024*32,约8.7TB的空量。有的人认为32bit全用，最大容量为2^32*1024*32，这种说法是不正确的。
>
>&emsp;&emsp;虽然FAT32具有容纳近乎8.7TB的容量，但实际应用中通常不使用超过32GB的FAT32分区。WIN2000及之上的OS已经不直接支持对超过32GB的分区格式化成FAT32，但WIN98依然可以格式化大到127GB的FAT32分区，但不推荐这样做。

>FAT文件总体结构

<table style="margin-top:-125px">
<tr>
<td>
引导扇区
</td>
<td>
其他保留扇区（可选）
</td>
<td>
FAT表1
</td>
<td>
FAT表2
</td>
<td>
根目录区
（仅FAT12/16）
</td>
<td>
数据区
（用于文件和目录
</td>
</tr>
</table>

>需要说明的是：
>> -  引导扇区和其他保留扇区一起称为保留扇区，而其他保留扇区是可选的，当没有时候，引导扇区后紧跟的就是FAT表1
>> -  根目录区是仅FAT12/16才有，FAT32的目录项位于数据区。由于FAT12/16的根目录区是一个固定的区域，所以它的根目录的项数是有限制的，意即不能在根录建立超过这个定数的目录项数。

## EXT与FAT文件系统的区别

> - EXT4文件系统一般用在Linux系统；
> - FAT文件系统一般使用在DOS、Windows 95文件系统，现在常用的Windows 98/2000/XP等系统均支持FAT文件系统。

### 优点

>FAT文件系统
>>- 新建文件简单
>>- 扩充文件简单
>>- 空间利用率较高(不会有外部碎片，有内部碎片，与簇大小有关系)

>EXT文件系统
>>- 新建文件简单
>>- 扩充文件简单
>>- 空间利用率较高(不会有外部碎片，有内部碎片，与簇大小有关系)
>>- 即使在随机访问文件里的数据，效率也比较高

### 缺点

>FAT文件系统
>>- 有时访问效率比较低下，由于查找一个文件的内容必须从头开始遍历，就算只需要最后的内容